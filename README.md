# Sia Metrics Collector

[![Build Status](https://travis-ci.org/mtlynch/sia_metrics_collector.svg?branch=master)](https://travis-ci.org/mtlynch/sia_metrics_collector) [![Docker Pulls](https://img.shields.io/docker/pulls/mtlynch/sia_metrics_collector.svg?maxAge=604800)](https://hub.docker.com/r/mtlynch/sia_metrics_collector/) [![Coverage Status](https://coveralls.io/repos/github/mtlynch/sia_metrics_collector/badge.svg?branch=master)](https://coveralls.io/github/mtlynch/sia_metrics_collector?branch=master)
[![License](http://img.shields.io/:license-mit-blue.svg?style=flat-square)](LICENSE)

## Overview

Sia Metrics Collector captures data about [Sia](https://sia.tech)'s state as it runs. For details of which metrics it collects

Sia Metrics Collector is a **read-only** tool. It will only observe the state of your Sia node. It will never perform any action changes the state of your Sia node (e.g. spending coins, deleting files).

## Example Graphs

The following graphs were all generated using the output of Sia Metrics Collector:

### Renter Spending over Time

[![Chart of renter spending over time](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/graphs/renter-spending-dev.png)](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/graphs/renter-spending-dev.png)

### Upload Bandwidth over Time

[![Chart of upload bandwidth over time](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/graphs/upload-bandwidth-dev.png)](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/graphs/upload-bandwidth-dev.png)

### Data Uploaded over Time

[![Chart of data uploaded over time](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/graphs/data-uploaded-dev.png)](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/graphs/data-uploaded-dev.png)


## Google Sheets Template

I created a [Google Sheets template](https://docs.google.com/spreadsheets/d/1ep-m_2K5hY9nF_D4TgKyGpp9arB6F3xPA7PJwQnskeg/edit?usp=sharing) that creates visualizations from the data generated by Sia Metrics Collector.

To use it:

1. Open the [Sia Load Test Metrics - TEMPLATE](https://docs.google.com/spreadsheets/d/1ep-m_2K5hY9nF_D4TgKyGpp9arB6F3xPA7PJwQnskeg/edit?usp=sharing) document.
1. Click File > Make a Copy:

    [![Screenshot of Make a Copy item](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/screenshots/sheets-import0.png)](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/screenshots/sheets-import0.png)
1. In the copy, click File > Import

    [![Screenshot of Import menu item](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/screenshots/sheets-import1.png)](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/screenshots/sheets-import1.png)
1. Click the "Upload" tab, then click "Select a file from your computer"

    [![Screenshot of Upload screen](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/screenshots/sheets-import2.png)](https://raw.githubusercontent.com/mtlynch/sia_metrics_collector/master/doc/screenshots/sheets-import2.png)
1. Select the output CSV file from Sia Metrics Collector

## Requirements

* Python 2.7
* A running Sia instance
  * Currently, it must be running on the same machine and listening for API calls on its default API port, 9980.

## Quick Start

It's easy to get started with Sia Metrics Collector.

```bash
# Install Sia Metrics Collector.
git clone https://github.com/mtlynch/sia_metrics_collector.git
cd sia_metrics_collector
pip install -r requirements.txt

# Begin collecting metrics.
python sia_metrics_collector\main.py \
  --poll_frequency 60 \
  --output_file "sia-metrics.csv"
```

## Development

Interested in contributing code to this project? Great! See our [contributor's guide](https://github.com/mtlynch/sia_metrics_collector/blob/master/.github/CONTRIBUTING.md).

## Metrics

### `timestamp`

The end time at which the set of metrics was collected, as an ISO-8601 string in UTC time. To get the start time of when this set of metrics started being collected, use `start_time = timestamp - api_latency`.

This is currently not a precise number because metrics are collected from different APIs and doesn't track the exact time each response was received, but rather, the timestamp that it completed querying all APIs for this set of metrics.

### `contract_count`

The total number of active contracts the renter holds.

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `file_count`

The total number of files the user is storing on Sia (includes both fully and partially uploaded files).

**Source**: [GET /renter/files](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#renterfiles-get)

### `uploads_in_progress_count`

The total number of files that are known to Sia, but whose upload progress is below 100%.

**Source**: [GET /renter/files](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#renterfiles-get)

### `total_contract_size`

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `total_file_bytes`

The total number of file bytes uploaded to Sia. This is `filesize * (uploadprogress / 100)`. This number is imprecise for partially uploaded files because the Sia API only offers upload progress rounded to the nearest hundredth.

**Source**: [GET /renter/files](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#renterfiles-get)

### `uploaded_bytes`

The total number of data bytes uploaded to Sia across all files, including redundant file copies. This only represents the amount of actual file data uploaded through the renter and does not represent the total number of bytes Sia has sent to the network. This does not include bytes from files that have since been deleted from Sia.

**Source**: [GET /renter/files](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#renterfiles-get)

### `total_contract_spending`

Total amount of Siacoins (in hastings) spent on contracts, across all active contracts.

The following equality should always hold:

```
total_contract_spending ==
  contract_fee_spending +
  storage_spending      +
  upload_spending       +
  download_spending     +
  remaining_renter_funds
```

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `contract_fee_spending`

Total amount of Siacoins (in hastings) spent on contract fees, across all active contracts.

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `storage_spending`

Total amount of Siacoins (in hastings) spent on storage, across all active contracts.

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `upload_spending`

Total amount of Siacoins (in hastings) spent on upload bandwidth, across all active contracts.

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `download_spending`

Total amount of Siacoins (in hastings) spent on download bandwidth, across all active contracts.

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `remaining_renter_funds`

Total amount of Siacoins (in hastings) that is allocated to active renter contracts, but has not yet been spent on fees, storage, upload, or download.

**Source**: [GET /renter/contracts](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Renter.md#rentercontracts-get)

### `wallet_siacoin_balance`

Confirmed Siacoin balance in wallet (in hastings).

**Source**: [GET /wallet](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Wallet.md#wallet-get)

### `wallet_outgoing_siacoins`

Total number of Siacoins (in hastings) currently in unconfirmed outgoing transactions.

**Source**: [GET /wallet](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Wallet.md#wallet-get)

### `wallet_incoming_siacoins`

Total number of Siacoins (in hastings) currently in unconfirmed incoming transactions.

**Source**: [GET /wallet](https://github.com/NebulousLabs/Sia/blob/master/doc/api/Wallet.md#wallet-get)

### `api_latency`

The total time (in milliseconds) that Sia Metrics Collector spent waiting for responses from Sia to collect each metric.
